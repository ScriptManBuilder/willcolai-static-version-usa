import React, { useState, useEffect } from 'react';
import { Container } from '../styles/GlobalStyles';
import {
  BlogWrapper,
  BlogHeader,
  BlogTitle,
  BlogSubtitle,
  BlogContent,
  FeaturedPost,
  FeaturedImage,
  FeaturedContent,
  FeaturedTitle,
  FeaturedExcerpt,
  FeaturedMeta,
  PostsGrid,
  BlogPost,
  PostImage,
  PostContent,
  PostTitle,
  PostExcerpt,
  PostMeta,
  AuthorInfo,
  AuthorAvatar,
  AuthorDetails,
  AuthorName,
  PostDate,
  CategoryTag,
  SearchSection,
  SearchInput,
  FilterButtons,
  FilterButton,
  LoadMoreButton,
  SidebarSection,
  SidebarTitle,
  PopularPosts,
  PopularPost,
  PopularPostTitle,
  NewsletterSignup,
  NewsletterTitle,
  NewsletterInput,
  NewsletterButton,
  ModalOverlay,
  ModalContent,
  ModalCloseButton,
  ModalHeader,
  ModalImage,
  ModalBody,
  ModalTitle,
  ModalMeta,
  ModalAuthor,
  ModalAuthorAvatar,
  ModalAuthorInfo,
  ModalAuthorName,
  ModalPostDate,
  ModalCategoryTag,
  ModalContent_Text,
  ClickablePost,
  ClickableFeaturedPost
} from '../styles/pages/BlogStyles';

interface BlogPostData {
  id: number;
  title: string;
  excerpt: string;
  content: string;
  image: string;
  author: string;
  date: string;
  category: string;
  readTime: string;
  featured?: boolean;
  comingSoon?: boolean;
}

const Blog: React.FC = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('All');
  const [visiblePosts, setVisiblePosts] = useState(6);
  const [email, setEmail] = useState('');
  const [emailError, setEmailError] = useState('');
  const [isSubscribing, setIsSubscribing] = useState(false);
  const [selectedPost, setSelectedPost] = useState<BlogPostData | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  const categories = ['All', 'AI Education', 'Machine Learning', 'Course Updates', 'Tech Trends', 'Student Success'];

  const blogPosts: BlogPostData[] = [
    {
      id: 1,
      title: "The Future of AI Education: Transforming How We Learn Technology",
      excerpt: "Discover how artificial intelligence is revolutionizing education and creating new opportunities for learners worldwide. From personalized learning paths to AI-powered tutoring systems.",
      content: "Artificial Intelligence is not just changing technology‚Äîit's transforming how we learn and teach. In this comprehensive guide, we explore the latest trends in AI education...",
      image: "/images/pictureAI_1.jpg",
      author: "Dr. Sarah Williams",
      date: "September 20, 2025",
      category: "AI Education",
      readTime: "8 min read",
      featured: true
    },
    {
      id: 2,
      title: "Machine Learning Fundamentals: Your Complete Beginner's Guide",
      excerpt: "Start your machine learning journey with confidence. Learn the essential concepts, algorithms, and practical applications that form the foundation of modern AI.",
      content: "Machine learning has become one of the most sought-after skills in technology. This comprehensive guide breaks down complex concepts into digestible lessons...",
      image: "/images/pictureAI_2.jpg",
      author: "Prof. Michael Chen",
      date: "September 18, 2025",
      category: "Machine Learning",
      readTime: "12 min read"
    },
    {
      id: 3,
      title: "New Course Launch: Advanced Neural Networks and Deep Learning",
      excerpt: "We're excited to announce our latest advanced course covering cutting-edge neural network architectures and deep learning techniques used by industry leaders.",
      content: "Our newest course takes you deep into the world of neural networks, covering everything from CNNs to transformers and everything in between...",
      image: "/images/pictureAI_3.jpg",
      author: "Williams AI Academy",
      date: "September 15, 2025",
      category: "Course Updates",
      readTime: "5 min read"
    },
    {
      id: 4,
      title: "Top 10 AI Trends Shaping 2025: What Every Professional Should Know",
      excerpt: "Stay ahead of the curve with the most important AI trends of 2025. From generative AI to autonomous systems, discover what's driving innovation.",
      content: "The AI landscape is evolving rapidly in 2025. Here are the ten most significant trends that are reshaping industries and creating new opportunities...",
      image: "/images/pictureAI_4.jpg",
      author: "Tech Research Team",
      date: "September 12, 2025",
      category: "Tech Trends",
      readTime: "10 min read"
    },
    {
      id: 5,
      title: "Student Success Story: From Beginner to AI Engineer in 6 Months",
      excerpt: "Meet Jennifer Rodriguez, who transformed her career from marketing to AI engineering through our comprehensive course program. Learn about her inspiring journey.",
      content: "Jennifer's story is proof that with dedication and the right education, anyone can master AI. Here's how she made the transition...",
      image: "/images/pictureAI_5.jpg",
      author: "Student Success Team",
      date: "September 10, 2025",
      category: "Student Success",
      readTime: "7 min read"
    },
    {
      id: 6,
      title: "Building Your First AI Project: A Step-by-Step Tutorial",
      excerpt: "Ready to get hands-on with AI? This tutorial walks you through creating your first machine learning project from data collection to deployment.",
      content: "Nothing beats learning by doing. In this practical tutorial, we'll build a complete AI project together, covering every step of the process...",
      image: "/images/pictureAI_6.jpg",
      author: "Dr. Alex Thompson",
      date: "September 8, 2025",
      category: "AI Education",
      readTime: "15 min read"
    },
    {
      id: 7,
      title: "The Ethics of AI: Responsible Development and Deployment",
      excerpt: "As AI becomes more powerful, understanding ethical considerations becomes crucial. Explore the principles of responsible AI development and deployment.",
      content: "With great power comes great responsibility. As AI capabilities expand, we must ensure ethical development and deployment practices...",
      image: "/images/pictureAI_7.jpg",
      author: "Ethics Committee",
      date: "September 5, 2025",
      category: "AI Education",
      readTime: "9 min read"
    },
    {
      id: 8,
      title: "Natural Language Processing: Understanding Human Language with AI",
      excerpt: "Dive into the fascinating world of NLP, where machines learn to understand, interpret, and generate human language with remarkable accuracy.",
      content: "Natural Language Processing represents one of the most exciting frontiers in AI, enabling machines to understand and generate human language...",
      image: "/images/pictureAI_8.jpg",
      author: "Dr. Lisa Park",
      date: "September 3, 2025",
      category: "Machine Learning",
      readTime: "11 min read"
    },
    {
      id: 9,
      title: "Computer Vision Applications: Seeing the World Through AI Eyes",
      excerpt: "Explore how computer vision is transforming industries from healthcare to autonomous vehicles, and learn to build your own vision applications.",
      content: "Computer vision has evolved from science fiction to everyday reality. Discover the applications that are changing our world...",
      image: "/images/pictureAI_9.png",
      author: "Vision AI Team",
      date: "September 1, 2025",
      category: "Machine Learning",
      readTime: "13 min read"
    },
    {
      id: 10,
      title: "üöÄ Coming Soon: Advanced AI Research & Development Trends",
      excerpt: "We're preparing an exclusive deep-dive into cutting-edge AI research, breakthrough technologies, and emerging industry trends. Stay tuned for insights from leading researchers and industry experts.",
      content: "This exciting new article is currently in development and will be published soon...",
      image: "/images/pictureAI_10.png",
      author: "Williams AI Research Team",
      date: "Coming Soon",
      category: "Tech Trends",
      readTime: "Coming Soon",
      comingSoon: true
    }
  ];

  const popularPosts = [
    { id: 1, title: "Getting Started with AI: Complete Roadmap", readTime: "6 min" },
    { id: 2, title: "Python for AI: Essential Libraries", readTime: "8 min" },
    { id: 3, title: "Career Transition to AI Field", readTime: "5 min" },
    { id: 4, title: "üöÄ Advanced AI Research Trends", readTime: "Coming Soon", comingSoon: true }
  ];

  // Email validation function
  const validateEmail = (email: string): boolean => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  };

  // Handle newsletter subscription
  const handleSubscribe = async () => {
    setEmailError('');
    
    if (!email.trim()) {
      setEmailError('Please enter your email address');
      return;
    }

    if (!validateEmail(email)) {
      setEmailError('Please enter a valid email address');
      return;
    }

    setIsSubscribing(true);
    
    // Simulate API call
    try {
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Success alert
      alert(`üéâ Success! Welcome to Williams AI Academy newsletter!\n\nEmail: ${email}\n\nYou'll receive the latest AI insights and course updates directly in your inbox.`);
      
      setEmail('');
    } catch (error) {
      alert('‚ùå Subscription failed. Please try again later.');
    } finally {
      setIsSubscribing(false);
    }
  };

  // Handle email input change
  const handleEmailChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setEmail(e.target.value);
    if (emailError) {
      setEmailError('');
    }
  };

  // Modal functions
  const openModal = (post: BlogPostData) => {
    if (post.comingSoon) return; // Don't open modal for coming soon posts
    setSelectedPost(post);
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden'; // Prevent background scroll
  };

  const closeModal = () => {
    setSelectedPost(null);
    setIsModalOpen(false);
    document.body.style.overflow = 'unset';
  };

  // Handle ESC key press
  useEffect(() => {
    const handleEscKey = (event: KeyboardEvent) => {
      if (event.key === 'Escape' && isModalOpen) {
        closeModal();
      }
    };

    if (isModalOpen) {
      document.addEventListener('keydown', handleEscKey);
    }

    return () => {
      document.removeEventListener('keydown', handleEscKey);
      document.body.style.overflow = 'unset'; // Cleanup on unmount
    };
  }, [isModalOpen]);

  // Handle click outside modal
  const handleOverlayClick = (e: React.MouseEvent) => {
    if (e.target === e.currentTarget) {
      closeModal();
    }
  };

  const filteredPosts = blogPosts.filter(post => {
    const matchesSearch = post.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         post.excerpt.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCategory = selectedCategory === 'All' || post.category === selectedCategory;
    return matchesSearch && matchesCategory;
  });

  const featuredPost = blogPosts.find(post => post.featured);
  const regularPosts = filteredPosts.filter(post => !post.featured).slice(0, visiblePosts);

  const handleLoadMore = () => {
    setVisiblePosts(prev => prev + 6);
  };

  return (
    <BlogWrapper>
      <Container>
        <BlogHeader>
          <BlogTitle>Williams AI Academy Blog</BlogTitle>
          <BlogSubtitle>
            Insights, tutorials, and updates from the world of artificial intelligence education
          </BlogSubtitle>
        </BlogHeader>

        <SearchSection>
          <SearchInput
            type="text"
            placeholder="Search articles..."
            value={searchTerm}
            onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearchTerm(e.target.value)}
          />
          <FilterButtons>
            {categories.map(category => (
              <FilterButton
                key={category}
                active={selectedCategory === category}
                onClick={() => setSelectedCategory(category)}
              >
                {category}
              </FilterButton>
            ))}
          </FilterButtons>
        </SearchSection>

        <BlogContent>
          <div style={{ flex: 1 }}>
            {featuredPost && selectedCategory === 'All' && !searchTerm && (
              <ClickableFeaturedPost onClick={() => openModal(featuredPost)}>
                <FeaturedPost>
                  <FeaturedImage src={featuredPost.image} alt={featuredPost.title} />
                  <FeaturedContent>
                    <CategoryTag>{featuredPost.category}</CategoryTag>
                    <FeaturedTitle>{featuredPost.title}</FeaturedTitle>
                    <FeaturedExcerpt>{featuredPost.excerpt}</FeaturedExcerpt>
                    <FeaturedMeta>
                      <AuthorInfo>
                        <AuthorAvatar src="/images/footer_1.jpg" alt={featuredPost.author} />
                        <AuthorDetails>
                          <AuthorName>{featuredPost.author}</AuthorName>
                          <PostDate>{featuredPost.date} ‚Ä¢ {featuredPost.readTime}</PostDate>
                        </AuthorDetails>
                      </AuthorInfo>
                    </FeaturedMeta>
                  </FeaturedContent>
                </FeaturedPost>
              </ClickableFeaturedPost>
            )}

            <PostsGrid>
              {regularPosts.map(post => (
                <ClickablePost key={post.id} onClick={() => openModal(post)}>
                  <BlogPost 
                    style={{
                      opacity: post.comingSoon ? 0.85 : 1,
                      border: post.comingSoon ? '2px dashed #667eea' : 'none',
                      background: post.comingSoon ? 'linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%)' : 'white',
                      animation: post.comingSoon ? 'glow 3s infinite' : 'none'
                    }}
                  >
                  <div style={{ position: 'relative' }}>
                    <PostImage 
                      src={post.image} 
                      alt={post.title}
                      style={{
                        filter: post.comingSoon ? 'grayscale(50%) blur(1px)' : 'none'
                      }}
                    />
                    {post.comingSoon && (
                      <div style={{
                        position: 'absolute',
                        top: '50%',
                        left: '50%',
                        transform: 'translate(-50%, -50%)',
                        background: 'rgba(102, 126, 234, 0.95)',
                        color: 'white',
                        padding: '8px 16px',
                        borderRadius: '20px',
                        fontSize: '0.9rem',
                        fontWeight: '600',
                        boxShadow: '0 4px 12px rgba(102, 126, 234, 0.3)',
                        backdropFilter: 'blur(4px)'
                      }}>
                        üöÄ Coming Soon
                      </div>
                    )}
                  </div>
                  <PostContent>
                    <CategoryTag style={{
                      background: post.comingSoon ? 
                        'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 
                        'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                      opacity: post.comingSoon ? 0.8 : 1,
                      animation: post.comingSoon ? 'pulse 2s infinite' : 'none'
                    }}>
                      {post.comingSoon ? 'üìÖ ' + post.category : post.category}
                    </CategoryTag>
                    <PostTitle style={{
                      color: post.comingSoon ? '#667eea' : '#2d3748'
                    }}>
                      {post.title}
                    </PostTitle>
                    <PostExcerpt style={{
                      fontStyle: post.comingSoon ? 'italic' : 'normal',
                      color: post.comingSoon ? '#5a67d8' : '#666'
                    }}>
                      {post.excerpt}
                    </PostExcerpt>
                    <PostMeta>
                      <AuthorInfo>
                        <AuthorAvatar 
                          src="/images/footer_2.jpg" 
                          alt={post.author}
                          style={{
                            filter: post.comingSoon ? 'grayscale(30%)' : 'none'
                          }}
                        />
                        <AuthorDetails>
                          <AuthorName style={{
                            color: post.comingSoon ? '#667eea' : '#2d3748'
                          }}>
                            {post.author}
                          </AuthorName>
                          <PostDate style={{
                            color: post.comingSoon ? '#667eea' : '#999',
                            fontWeight: post.comingSoon ? '600' : 'normal'
                          }}>
                            {post.comingSoon ? (
                              <span>
                                üïê {post.date} ‚Ä¢ {post.readTime}
                              </span>
                            ) : (
                              `${post.date} ‚Ä¢ ${post.readTime}`
                            )}
                          </PostDate>
                        </AuthorDetails>
                      </AuthorInfo>
                    </PostMeta>
                    {post.comingSoon && (
                      <div style={{
                        marginTop: '15px',
                        padding: '10px',
                        background: 'rgba(102, 126, 234, 0.1)',
                        borderRadius: '8px',
                        textAlign: 'center',
                        fontSize: '0.85rem',
                        color: '#667eea',
                        fontWeight: '500'
                      }}>
                        üí° Subscribe to our newsletter to be notified when this article is published!
                      </div>
                    )}
                  </PostContent>
                </BlogPost>
                </ClickablePost>
              ))}
            </PostsGrid>

            {regularPosts.length < filteredPosts.filter(post => !post.featured).length && (
              <div style={{ textAlign: 'center', marginTop: '40px' }}>
                <LoadMoreButton onClick={handleLoadMore}>
                  Load More Articles
                </LoadMoreButton>
              </div>
            )}
          </div>

          <SidebarSection>
            <div>
              <SidebarTitle>Popular Articles</SidebarTitle>
              <PopularPosts>
                {popularPosts.map((post: any) => (
                  <PopularPost 
                    key={post.id}
                    style={{
                      background: post.comingSoon ? 'linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%)' : 'transparent',
                      border: post.comingSoon ? '1px dashed #667eea' : 'none',
                      borderRadius: post.comingSoon ? '8px' : '0',
                      padding: post.comingSoon ? '12px' : '15px 0'
                    }}
                  >
                    <PopularPostTitle style={{
                      color: post.comingSoon ? '#667eea' : '#2d3748',
                      fontStyle: post.comingSoon ? 'italic' : 'normal'
                    }}>
                      {post.title}
                    </PopularPostTitle>
                    <PostDate style={{
                      color: post.comingSoon ? '#667eea' : '#999',
                      fontWeight: post.comingSoon ? '600' : 'normal'
                    }}>
                      {post.comingSoon ? 'üïê ' + post.readTime : post.readTime}
                    </PostDate>
                  </PopularPost>
                ))}
              </PopularPosts>
            </div>

            <NewsletterSignup>
              <NewsletterTitle>Stay Updated</NewsletterTitle>
              <p>Get the latest AI insights delivered to your inbox</p>
              <div style={{ position: 'relative' }}>
                <NewsletterInput
                  type="email"
                  placeholder="Enter your email"
                  value={email}
                  onChange={handleEmailChange}
                  style={{
                    borderColor: emailError ? '#e53e3e' : undefined,
                    marginBottom: emailError ? '5px' : '15px'
                  }}
                />
                {emailError && (
                  <div style={{
                    color: '#e53e3e',
                    fontSize: '0.8rem',
                    marginBottom: '10px',
                    textAlign: 'left'
                  }}>
                    {emailError}
                  </div>
                )}
              </div>
              <NewsletterButton 
                onClick={handleSubscribe}
                disabled={isSubscribing}
                style={{
                  opacity: isSubscribing ? 0.7 : 1,
                  cursor: isSubscribing ? 'not-allowed' : 'pointer'
                }}
              >
                {isSubscribing ? (
                  <span style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}>
                    <span style={{
                      width: '16px',
                      height: '16px',
                      border: '2px solid #667eea',
                      borderTop: '2px solid transparent',
                      borderRadius: '50%',
                      animation: 'spin 1s linear infinite'
                    }}></span>
                    Subscribing...
                  </span>
                ) : (
                  'Subscribe'
                )}
              </NewsletterButton>
              <style>
                {`
                  @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                  }
                  
                  @keyframes pulse {
                    0%, 100% { opacity: 0.8; }
                    50% { opacity: 1; }
                  }
                  
                  @keyframes glow {
                    0%, 100% { box-shadow: 0 0 5px rgba(102, 126, 234, 0.3); }
                    50% { box-shadow: 0 0 15px rgba(102, 126, 234, 0.6); }
                  }
                `}
              </style>
            </NewsletterSignup>
          </SidebarSection>
        </BlogContent>
      </Container>
      
      {/* Modal */}
      {isModalOpen && selectedPost && (
        <ModalOverlay onClick={handleOverlayClick}>
          <ModalContent onClick={(e) => e.stopPropagation()}>
            <ModalCloseButton onClick={closeModal}>
              ‚úï
            </ModalCloseButton>
            
            <ModalHeader>
              <ModalImage src={selectedPost.image} alt={selectedPost.title} />
            </ModalHeader>
            
            <ModalBody>
              <ModalTitle>{selectedPost.title}</ModalTitle>
              
              <ModalMeta>
                <ModalCategoryTag>{selectedPost.category}</ModalCategoryTag>
                <ModalAuthor>
                  <ModalAuthorAvatar src="/images/footer_2.jpg" alt={selectedPost.author} />
                  <ModalAuthorInfo>
                    <ModalAuthorName>{selectedPost.author}</ModalAuthorName>
                    <ModalPostDate>{selectedPost.date} ‚Ä¢ {selectedPost.readTime}</ModalPostDate>
                  </ModalAuthorInfo>
                </ModalAuthor>
              </ModalMeta>
              
              <ModalContent_Text>
                {selectedPost.content}
                
                <h3>Key Takeaways</h3>
                <ul>
                  <li>Artificial Intelligence is transforming education through personalized learning experiences</li>
                  <li>AI-powered tutoring systems provide 24/7 support and adaptive learning paths</li>
                  <li>Machine learning algorithms can identify student learning patterns and optimize content delivery</li>
                  <li>The future of education combines human expertise with AI capabilities</li>
                </ul>
                
                <blockquote>
                  "The intersection of AI and education represents one of the most promising frontiers for improving learning outcomes and accessibility worldwide."
                </blockquote>
                
                <h3>What's Next?</h3>
                <p>As we continue to explore the potential of AI in education, we're seeing unprecedented opportunities for personalized, accessible, and effective learning experiences. The key is finding the right balance between technological innovation and human connection in the learning process.</p>
                
                <p>Ready to dive deeper into AI education? Explore our comprehensive courses and join thousands of learners who are already transforming their careers with AI knowledge.</p>
              </ModalContent_Text>
            </ModalBody>
          </ModalContent>
        </ModalOverlay>
      )}
    </BlogWrapper>
  );
};

export default Blog;